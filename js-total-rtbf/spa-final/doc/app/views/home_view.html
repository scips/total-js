<!DOCTYPE html><html lang="en"><head><title>app/views/home_view</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../"><meta name="groc-document-path" content="app/views/home_view"><meta name="groc-project-path" content="app/views/home_view.js"><link rel="stylesheet" type="text/css" media="all" href="../../assets/style.css"><script type="text/javascript" src="../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">app/views/home_view.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="contrleur-principal">Contrôleur principal</h1></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-pi">
'use strict'</span>;

<span class="hljs-keyword">var</span> moment = <span class="hljs-built_in">require</span>(<span class="hljs-string">'moment'</span>);
<span class="hljs-keyword">var</span> View = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./view'</span>);
<span class="hljs-keyword">var</span> CheckInView = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./check_in_view'</span>);
<span class="hljs-keyword">var</span> HistoryView = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./history_view'</span>);
<span class="hljs-keyword">var</span> cnxSvc = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lib/connectivity'</span>);
<span class="hljs-keyword">var</span> userName = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lib/notifications'</span>).userName;

<span class="hljs-built_in">module</span>.exports = View.extend({</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="vnements-applicatifs">Événements applicatifs</h2></div></div></div><div class="segment"><div class="code"><div class="wrapper">  subscriptions: {
    <span class="hljs-string">'connectivity:online'</span>: <span class="hljs-string">'syncMarker'</span>,
    <span class="hljs-string">'connectivity:offline'</span>: <span class="hljs-string">'syncMarker'</span>
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="templates">Templates</h2></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Le template principal</p></div></div><div class="code"><div class="wrapper">  template: <span class="hljs-built_in">require</span>(<span class="hljs-string">'./templates/home'</span>),</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Après le rendering complet (initial), on procède aux initialisations
de comportements et injections des vues imbriquées</p></div></div><div class="code"><div class="wrapper">  afterRender: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">afterHomeRender</span>(<span class="hljs-params"></span>) </span>{</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>On met en cache le marqueur online/offline et on lui colle un tooltip façon Bootstrap</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">this</span>.syncMarker();</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>On lance l&#39;horloge (en haut à droite)</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">this</span>.startClock();</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>On initialise et on render à la volée les deux vues imbriquées</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">new</span> CheckInView({ el: <span class="hljs-keyword">this</span>.$(<span class="hljs-string">'#checkInUI'</span>) }).render();
    <span class="hljs-keyword">new</span> HistoryView({ el: <span class="hljs-keyword">this</span>.$(<span class="hljs-string">'#historyUI'</span>) }).render();
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Convention définie par notre classe mère View pour render : on
peuple le template principal avec ces données.</p></div></div><div class="code"><div class="wrapper">  getRenderData: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getHomeRenderData</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Moment.js c&#39;est que du bonheur…</p></div></div><div class="code"><div class="wrapper">      now: moment().format(<span class="hljs-string">'dddd D MMMM YYYY HH:mm:ss'</span>),
      userName: userName
    };
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Lancement de l&#39;horloge.  Un simple setInterval suffit…</p></div></div><div class="code"><div class="wrapper">  startClock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">startClock</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> clock = <span class="hljs-keyword">this</span>.$(<span class="hljs-string">'#ticker'</span>);
    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
    setInterval(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      clock.text(that.getRenderData().now);
    }, <span class="hljs-number">1000</span>);
  },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Réaction à la notif de passage online/offline : on ajuste le marqueur</p></div></div><div class="code"><div class="wrapper">  syncMarker: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">syncMarker</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.$onlineMarker = <span class="hljs-keyword">this</span>.$onlineMarker || <span class="hljs-keyword">this</span>.$(<span class="hljs-string">'#onlineMarker'</span>).tooltip({ placement: <span class="hljs-string">'bottom'</span> });
    <span class="hljs-keyword">this</span>.$onlineMarker[cnxSvc.isOnline() ? <span class="hljs-string">'show'</span> : <span class="hljs-string">'hide'</span>](<span class="hljs-string">'fast'</span>);
  }
});</div></div></div></div></body></html>